---
layout: post
title: "Hello World"
categories:
- 博客
---

很感兴趣于键盘控制这一部分，所以决定先阅读input_mannager.js

仔细查看了input_mannager.js的源代码发现好多的prototype。那先来看看prototype是什么？

###JS中的prototype

在JavaScript语言中，每一个对象都有一个对应的原型对象，被称为prototype对象。定义在原型对象上的所有属性和方法，都能被派生对象继承。

那么这里如果修改了prototype对象，变动就立刻会体现在实例对象中。

###call（）

JavaScript中this的动态切换，为其创造了巨大的灵活性，但也使得编程变得困难和模糊。input_mannager.js这里运用了call（）的方法来固定this的作用域。

函数的call方法，可以指定该函数内部this的指向，然后在所指定的作用域中，调用该函数。

	func.call(thisValue, arg1, arg2, …)

可以理解为应用func在thisValue的作用域内， arg1, arg2是可以传入的参数。

###input_mannager.js

KeyboardInputManager函数有如下结构：

![思维导图](http://7xjufd.dl1.z0.glb.clouddn.com/blog2.1.png)

function KeyboardInputManager中通过if判断语句定义了this.eventTouchstart，this.eventTouchmove，this.eventTouchend      

	if (window.navigator.msPointerEnabled) {
    //这里考虑的是浏览器兼容性的问题
    //if里的判断语句是判断用户设备是不是Internet Explorer 10 支不支持msPointer相关事件
    this.eventTouchstart    = "MSPointerDown";
    this.eventTouchmove     = "MSPointerMove";
    this.eventTouchend      = "MSPointerUp";
  	} else {
    this.eventTouchstart    = "touchstart";
    this.eventTouchmove     = "touchmove";
    this.eventTouchend      = "touchend";
  }
  

##### KeyboardInputManager.prototype.listen（）{}

首先是键盘控制

   	document.addEventListener("keydown", function (event){}
   	//对全局进行事件监听，把握键盘方向键的控制

    if (!modifiers && event.which === 82) {
      self.restart.call(self, event);
    }//添加R快捷键的行为
    
  	this.bindButtonPress(".retry-button", this.restart);
  	this.bindButtonPress(".restart-button", this.restart);
  	this.bindButtonPress(".keep-playing-button", this.keepPlaying);
  	//分别给重新开始，继续玩等按钮添加行为。

  
  
然后是移动端滑动控制


	var touchStartClientX, touchStartClientY;
  	var gameContainer = document.getElementsByClassName("game-container")[0];
  	//对game-container进行事件监听，只有在game-container里的滑动才有效
		  gameContainer.addEventListener(this.eventTouchstart, function (event) {
    if ((!window.navigator.msPointerEnabled && event.touches.length > 1) ||event.targetTouches > 1) 
    //将多余一个指头的滑动事件忽略
 	{   return; 
    if (window.navigator.msPointerEnabled) {}}
    //获取滑动的起始坐标
    、
    、
    、
    //判断滑动方向
    if (Math.max(absDx, absDy) > 10) {
    self.emit("move", absDx > absDy ? (dx > 0 ? 1 : 3) : (dy > 0 ? 2 : 0));
    }
    // (right : left) : (down : up)

      

### 参考引用
