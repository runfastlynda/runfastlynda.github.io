{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/2015-08-26-read-source-code-of-2048-5/","result":{"data":{"site":{"siteMetadata":{"title":"runfastlynda","social":[{"name":"twitter","url":"https://twitter.com/runfastlynda"},{"name":"github","url":"https://github.com/runfastlynda"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"1a49fc21-48e7-5cb8-81ac-f3667cbce883","excerpt":"2048源码解读系列最后一篇，我们来解读最重要的 GameManager 部分。 GameManager函数有如下结构： 函数输入了size, InputManager, Actuator, StorageManager这四个参数，这都是之前我们解读过的，\n参数传入后，size…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"date\": \"2015-08-26T00:00:00.000Z\",\n  \"title\": \"2048源代码解读（5）\",\n  \"categories\": [\"sourcecode\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"2048\\u6E90\\u7801\\u89E3\\u8BFB\\u7CFB\\u5217\\u6700\\u540E\\u4E00\\u7BC7\\uFF0C\\u6211\\u4EEC\\u6765\\u89E3\\u8BFB\\u6700\\u91CD\\u8981\\u7684 GameManager \\u90E8\\u5206\\u3002\"), mdx(\"p\", null, \"GameManager\\u51FD\\u6570\\u6709\\u5982\\u4E0B\\u7ED3\\u6784\\uFF1A\", mdx(\"img\", {\n    \"src\": \"http://7xjufd.dl1.z0.glb.clouddn.com/blog5.1.png\",\n    \"parentName\": \"p\"\n  })), mdx(\"p\", null, \"\\u51FD\\u6570\\u8F93\\u5165\\u4E86size, InputManager, Actuator, StorageManager\\u8FD9\\u56DB\\u4E2A\\u53C2\\u6570\\uFF0C\\u8FD9\\u90FD\\u662F\\u4E4B\\u524D\\u6211\\u4EEC\\u89E3\\u8BFB\\u8FC7\\u7684\\uFF0C\\n\\u53C2\\u6570\\u4F20\\u5165\\u540E\\uFF0Csize \\u8D4B\\u503C\\u7ED9\\u5F53\\u524D\\u5BF9\\u8C61\\u7684size\\uFF0C\\u5176\\u4ED6\\u4E09\\u4E2A\\u53C2\\u6570\\u901A\\u8FC7new\\u547D\\u4EE4\\u8C03\\u7528\\u4E86\\u6784\\u9020\\u51FD\\u6570\\uFF0C\\u8FD4\\u56DE\\u4E09\\u4E2A\\u5B9E\\u4F8B\\u5BF9\\u8C61\\uFF0C\\n\\u521D\\u59CB\\u5316tile\\u5F00\\u59CB\\u65F6\\u4E3A2\\u4E2A\\uFF0C\\u7ED1\\u5B9Ainputmanager\\u7684move\\uFF0Crestart\\uFF0CkeepPlaying\\u5230\\u5F53\\u524D\\u5BF9\\u8C61\\uFF0C\\n\\u6700\\u540E\\u662F\\u91CD\\u8981\\u7684setup\\u51FD\\u6570\\u3002\"), mdx(\"h5\", {\n    \"id\": \"setup函数\"\n  }, \"setup\\u51FD\\u6570\"), mdx(\"p\", null, \"setup\\u51FD\\u6570\\u5B9A\\u4E49\\u6E38\\u620F\\u7684\\u6267\\u884C\\u65B9\\u6CD5\\uFF0C\\u9996\\u5148\\u4ECEstorageManager\\u91CC\\u83B7\\u53D6\\u6E38\\u620F\\u7684\\u72B6\\u6001\\uFF0C\\u5982\\u679C\\u5B58\\u5728\\uFF0C\\n\\u628A\\u76F8\\u5E94\\u7684\\u72B6\\u6001\\u4FE1\\u606F\\u4F20\\u5165\\uFF0C\\u5426\\u5219\\uFF0C\\u521D\\u59CB\\u5316\\u8FD9\\u4E9B\\u72B6\\u6001\\u4FE1\\u606F\\u3002\\u7136\\u540E\\u5F00\\u59CB\\u6267\\u884C\\u6E38\\u620F\\uFF1Aactuate()\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    \"className\": \"language-javascript\",\n    \"parentName\": \"pre\"\n  }, \"GameManager.prototype.setup = function () {\\n  //\\u53D6\\u5F97\\u6E38\\u620F\\u72B6\\u6001\\n  var previousState = this.storageManager.getGameState();\\n  // \\u5982\\u679C\\u5B58\\u5728\\uFF0C\\u90A3\\u4E48\\u52A0\\u8F7D\\u4E4B\\u524D\\u7684\\u6E38\\u620F\\u3002\\u5426\\u5219\\u521D\\u59CB\\u5316\\u6E38\\u620F\\u7684\\u5F00\\u59CB\\u72B6\\u6001\\n  if (previousState) {\\n    this.grid        = new Grid(previousState.grid.size,\\n                            previousState.grid.cells); // Reload grid\\n    this.score       = previousState.score;\\n    this.over        = previousState.over;\\n    this.won         = previousState.won;\\n    this.keepPlaying = previousState.keepPlaying;\\n    } else {\\n      this.grid        = new Grid(this.size);\\n      this.score       = 0;\\n      this.over        = false;\\n      this.won         = false;\\n      this.keepPlaying = false;\\n\\n      // \\u6DFB\\u52A0tile\\n      this.addStartTiles();\\n    }\\n    this.actuate();\\n  };\\n\")), mdx(\"p\", null, \"\\u8FD9\\u91CC\\u5B9A\\u4E49\\u4E86\\u6DFB\\u52A0\\u521D\\u59CBtile\\u7684\\u65B9\\u6CD5\"), mdx(\"pre\", null, mdx(\"code\", {\n    \"className\": \"language-javascript\",\n    \"parentName\": \"pre\"\n  }, \"// \\u8BBE\\u7F6E\\u521D\\u59CBtile\\u5F00\\u59CB\\u6E38\\u620F\\nGameManager.prototype.addStartTiles = function () {\\n  for (var i = 0; i < this.startTiles; i++) {\\n    this.addRandomTile();\\n  }\\n};\\n\\n// \\u5728\\u968F\\u673A\\u4F4D\\u7F6E\\u6DFB\\u52A0\\u4E00\\u4E2Atile\\uFF0C\\u8FD9\\u91CC\\u7ED9tile\\u6DFB\\u52A0\\u503C\\u7528Math.random()\\u7684\\u65B9\\u6CD5\\uFF0C\\n\\u53D6\\u5F97\\u57280~1\\u4E4B\\u95F4\\u7684\\u968F\\u673A\\u6570\\uFF0C\\u5982\\u679C\\u5C0F\\u4E8E0.9\\uFF0C\\u503C\\u4E3A2\\uFF0C\\u5426\\u5219\\u503C\\u4E3A4.\\nGameManager.prototype.addRandomTile = function () {\\n  if (this.grid.cellsAvailable()) {\\n    var value = Math.random() < 0.9 ? 2 : 4;\\n    var tile = new Tile(this.grid.randomAvailableCell(), value);\\n\\n    this.grid.insertTile(tile);\\n  }\\n};\\n\")), mdx(\"h5\", {\n    \"id\": \"move函数\"\n  }, \"move\\u51FD\\u6570\"), mdx(\"p\", null, \"\\u79FB\\u52A8\\u884C\\u4E3A\\u5BF9\\u5E94\\u51FD\\u6570\\uFF0C\\u4FDD\\u5B58\\u5F53\\u524Dtile\\u4F4D\\u7F6E\\uFF0C\\u5B9A\\u4E49\\u4E86\\u5408\\u5E76\\u884C\\u4E3A\\uFF0C\\u5982\\u679C\\u76F8\\u90BB\\u7684\\u4E24\\u4E2Atile\\u7684\\u503C\\u5B58\\u5728\\u4E14\\u76F8\\u7B49\\uFF0C\\n\\u66F4\\u65B0\\u6210\\u7EE9\\u4F4D\\u7F6E\"), mdx(\"pre\", null, mdx(\"code\", {\n    \"className\": \"language-javascript\",\n    \"parentName\": \"pre\"\n  }, \"GameManager.prototype.move = function (direction) {\\n  // \\u4F7F\\u7528\\u4E2D\\u95F4\\u53D8\\u91CF\\u56FA\\u5B9Athis\\u5BF9\\u8C61\\n  var self = this;\\n\\n  if (this.isGameTerminated()) return;\\n  // \\u5982\\u679C\\u6E38\\u620F\\u7ED3\\u675F\\uFF0C\\u4E0D\\u505A\\u4EFB\\u4F55\\u4E8B\\u60C5\\n\\n  var cell, tile;\\n\\n  var vector     = this.getVector(direction);\\n  var traversals = this.buildTraversals(vector);\\n  var moved      = false;\\n\\n  // \\u4FDD\\u5B58\\u5F53\\u524Dtile\\u4F4D\\u7F6E\\u5E76\\u5220\\u9664\\u5408\\u5E76\\u4FE1\\u606F\\n  this.prepareTiles();\\n\\n  // \\u5728\\u6B63\\u786E\\u7684\\u65B9\\u5411\\u4E0A\\u79FB\\u52A8\\u7F51\\u683C\\u548C\\u79FB\\u52A8\\u7684tile\\n  traversals.x.forEach(function (x) {\\n    traversals.y.forEach(function (y) {\\n      cell = { x: x, y: y };\\n      tile = self.grid.cellContent(cell);\\n\\n      if (tile) {\\n        var positions = self.findFarthestPosition(cell, vector);\\n        var next      = self.grid.cellContent(positions.next);\\n\\n        // \\u5B9A\\u4E49\\u4E86\\u5408\\u5E76\\u884C\\u4E3A\\uFF0C\\u5982\\u679C\\u76F8\\u90BB\\u7684\\u4E24\\u4E2Atile\\u7684\\u503C\\u5B58\\u5728\\u4E14\\u76F8\\u7B49\\uFF0C\\n        \\u5148\\u751F\\u6210\\u65B0\\u7684tile\\uFF0C\\u4FDD\\u5B58\\u4FE1\\u606F\\uFF0C\\u7136\\u540E\\u5220\\u9664\\u5F53\\u524D\\u7684\\u4E24\\u4E2Atile\\n        if (next && next.value === tile.value && !next.mergedFrom) {\\n          var merged = new Tile(positions.next, tile.value * 2);\\n          merged.mergedFrom = [tile, next];\\n\\n          self.grid.insertTile(merged);\\n          self.grid.removeTile(tile);\\n\\n          // \\u66F4\\u65B0\\u4E24\\u4E2Atile\\u4F4D\\u7F6E\\n          tile.updatePosition(positions.next);\\n\\n          // \\u66F4\\u65B0\\u6210\\u7EE9\\n          self.score += merged.value;\\n\\n          if (merged.value === 2048) self.won = true;\\n          } else {\\n            self.moveTile(tile, positions.farthest);\\n          }\\n\\n          if (!self.positionsEqual(cell, tile)) {\\n            moved = true; // tile\\u4ECE\\u539F\\u6765\\u7684cell\\u79FB\\u52A8\\uFF01\\n          }\\n        }\\n    });\\n  });\\n\")), mdx(\"h5\", {\n    \"id\": \"buildtraversals\"\n  }, \"buildTraversals\"), mdx(\"p\", null, \"\\u6784\\u5EFA\\u4E00\\u4E2A\\u4EE5\\u6B63\\u786E\\u7684\\u987A\\u5E8F\\u904D\\u5386\\u7684\\u4F4D\\u7F6E\\u5217\\u8868\\uFF0C\\u662F\\u5B9E\\u884Cmove\\u51FD\\u6570\\u7684\\u5177\\u4F53\\u7EC6\\u8282\"), mdx(\"pre\", null, mdx(\"code\", {\n    \"className\": \"language-javascript\",\n    \"parentName\": \"pre\"\n  }, \"GameManager.prototype.buildTraversals = function (vector) {\\n  var traversals = { x: [], y: [] };\\n\\n  for (var pos = 0; pos < this.size; pos++) {\\n    traversals.x.push(pos);\\n    traversals.y.push(pos);\\n  }\\n\\n  // \\u603B\\u662F\\u4ECE\\u6700\\u8FDC\\u7684\\u5355\\u5143\\u683C\\u4E2D\\u9009\\u62E9\\u65B9\\u5411\\n  if (vector.x === 1) traversals.x = traversals.x.reverse();\\n  if (vector.y === 1) traversals.y = traversals.y.reverse();\\n\\n  return traversals;\\n};\\n\")), mdx(\"h5\", {\n    \"id\": \"findfarthestposition函数\"\n  }, \"findFarthestPosition\\u51FD\\u6570\"), mdx(\"p\", null, \"\\u5408\\u5E76\\u52A8\\u4F5C\\uFF0C\\u5408\\u5E76\\u76F8\\u540C\\u7684tile\\uFF0C\\u76F4\\u5230\\u4E0D\\u80FD\\u5408\\u5E76\"), mdx(\"pre\", null, mdx(\"code\", {\n    \"className\": \"language-javascript\",\n    \"parentName\": \"pre\"\n  }, \"GameManager.prototype.findFarthestPosition = function (cell, vector) {\\n  var previous;\\n\\n  // \\u671D\\u7740\\u77E2\\u91CF\\u65B9\\u5411\\u524D\\u8FDB\\uFF0C\\u76F4\\u5230\\u627E\\u5230\\u4E00\\u4E2A\\u969C\\u788D\\u7269\\n  do {\\n    previous = cell;\\n    cell     = { x: previous.x + vector.x, y: previous.y + vector.y };\\n    } while (this.grid.withinBounds(cell) &&\\n    this.grid.cellAvailable(cell));\\n\\n    return {\\n      farthest: previous,\\n      next: cell // Used to check if a merge is required  \\u7528\\u4E8E\\u68C0\\u67E5\\u662F\\u5426\\u9700\\u8981\\u5408\\u5E76\\n    };\\n  };\\n\")), mdx(\"h5\", {\n    \"id\": \"tilematchesavailable函数\"\n  }, \"tileMatchesAvailable\\u51FD\\u6570\"), mdx(\"p\", null, \"\\u68C0\\u67E5\\u53EF\\u7528\\u7684\\u5339\\u914D\\u4E4B\\u95F4\\u7684tile\"), mdx(\"pre\", null, mdx(\"code\", {\n    \"className\": \"language-javascript\",\n    \"parentName\": \"pre\"\n  }, \"GameManager.prototype.tileMatchesAvailable = function () {\\n  var self = this;\\n\\n  var tile;\\n\\n  for (var x = 0; x < this.size; x++) {\\n    for (var y = 0; y < this.size; y++) {\\n      tile = this.grid.cellContent({ x: x, y: y });\\n\\n      if (tile) {\\n        for (var direction = 0; direction < 4; direction++) {\\n          var vector = self.getVector(direction);\\n          var cell   = { x: x + vector.x, y: y + vector.y };\\n\\n          var other  = self.grid.cellContent(cell);\\n\\n          if (other && other.value === tile.value) {\\n            return true; // \\u8FD4\\u56DEture\\uFF0C\\u5C31\\u53EF\\u4EE5\\u5408\\u5E76\\n          }\\n        }\\n      }\\n    }\\n  }\\n\\n  return false;// \\u5426\\u5219\\u4E0D\\u5408\\u5E76\\n};\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/2015-08-26-read-source-code-of-2048-5/","title":"2048源代码解读（5）","tags":[],"keywords":[],"date":"August 26, 2015","image":null,"imageAlt":null,"socialImage":null},"previous":{"__typename":"MdxBlogPost","id":"a2e0ff92-bd48-5bec-938d-6fbe06a360c2","excerpt":"经常遇到Collapsing Margins，也就是margin折叠的情况，可总是不知道哪里出现了问题。\n那就让我们来探讨下这个 margin 折叠 到底是什么鬼？它们是如何影响页面上的元素的？我们该如何拿下它？ margin折叠是什么？ 在W3C规范是这样定义margin…","slug":"/2015-08-26-collapsing-margins/","title":"说说Collapsing Margins","date":"August 26, 2015"},"next":{"__typename":"MdxBlogPost","id":"a41323d3-1f19-5f9b-8aca-c9bef3678cfe","excerpt":"我们这次的目标是做一个响应式导航菜单，不使用javascript，只使用CSS就可以做到。就像这样： 初试效果 响应式效果 HTML代码 我们要利用label元素的\"for\"属性，对应一个checkbox的id 上面的代码表示：当我们点击  Clickme  就等于input…","slug":"/2015-08-28-css-responsive-navigation-menu/","title":"用CSS设计响应式导航菜单","date":"August 28, 2015"}},"pageContext":{"id":"1a49fc21-48e7-5cb8-81ac-f3667cbce883","previousId":"a2e0ff92-bd48-5bec-938d-6fbe06a360c2","nextId":"a41323d3-1f19-5f9b-8aca-c9bef3678cfe"}},"staticQueryHashes":["386998304","4198970465","764694655"]}