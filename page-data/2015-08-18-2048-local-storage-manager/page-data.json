{"componentChunkName":"component---src-templates-blog-post-js","path":"/2015-08-18-2048-local-storage-manager/","result":{"data":{"site":{"siteMetadata":{"title":"runfastlyndağŸ‘€"}},"markdownRemark":{"id":"a3a3a88b-7700-5fde-8004-e3dacb8e303a","excerpt":"å‰é¢ä¸€ç¯‡å·²ç»ä»‹ç»äº†inputmannager.jsé‚£ä¸€éƒ¨åˆ†çš„ä»£ç ï¼Œæ¥ç€æƒ³äº†è§£æ¸¸æˆä¸­çš„çŠ¶æ€æ•°æ®æ˜¯æ€ä¹ˆå­˜å‚¨å’Œè°ƒç”¨çš„ï¼Œæ‰€ä»¥æ¥é˜…è¯»localstorage_manager.jsã€‚ localstoragemanager.jsåŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šwindow.fakeStorageå’ŒLocalStorageManagerâ€¦","html":"<p><a href=\"http://runfastlynda.com/2048-input-mannager/\">å‰é¢ä¸€ç¯‡</a>å·²ç»ä»‹ç»äº†input<em>mannager.jsé‚£ä¸€éƒ¨åˆ†çš„ä»£ç ï¼Œæ¥ç€æƒ³äº†è§£æ¸¸æˆä¸­çš„çŠ¶æ€æ•°æ®æ˜¯æ€ä¹ˆå­˜å‚¨å’Œè°ƒç”¨çš„ï¼Œæ‰€ä»¥æ¥é˜…è¯»local</em>storage_manager.jsã€‚</p>\n<p>local<em>storage</em>manager.jsåŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šwindow.fakeStorageå’ŒLocalStorageManagerå‡½æ•°ã€‚æŸ¥çœ‹åˆ°å‰è€…åœ¨LocalStorageManagerå‡½æ•°ä¸­æœ‰è°ƒç”¨ï¼Œæ‰€ä»¥å†³å®šå…ˆé˜…è¯»LocalStorageManagerã€‚</p>\n<p>LocalStorageManagerå‡½æ•°æœ‰å¦‚ä¸‹ç»“æ„ï¼š\n<img src=\"http://7xjufd.dl1.z0.glb.clouddn.com/blog3.1.png\"></p>\n<p>åœ¨LocalStorageManagerå‡½æ•°ä¸­å…ˆæŠŠ bestScoreKeyå’ŒgameStateKeyçš„é”®èµ‹ä¸ºbestScore ä¸gameStateï¼Œç„¶åä½¿ç”¨ä¸‰ç›®è¿ç®—ç»™ storage èµ‹å€¼ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">LocalStorageManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bestScoreKey     <span class=\"token operator\">=</span> <span class=\"token string\">\"bestScore\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gameStateKey     <span class=\"token operator\">=</span> <span class=\"token string\">\"gameState\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> supported <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">localStorageSupported</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>storage <span class=\"token operator\">=</span> supported <span class=\"token operator\">?</span> window<span class=\"token punctuation\">.</span>localStorage <span class=\"token operator\">:</span> window<span class=\"token punctuation\">.</span>fakeStorage<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//å¯¹supportedè¿›è¡Œåˆ¤æ–­ï¼ˆsupportedä¸‹é¢æœ‰å®šä¹‰ï¼‰ï¼Œè¿”å›trueä½¿ç”¨window.localStorageï¼Œå¦åˆ™ä½¿ç”¨window.fakeStorageã€‚</span></code></pre></div>\n<p>è¿™é‡Œæ¶‰åŠäº†supportedä¸window.fakeStorageã€‚ä¸‹æ–‡ä¸€ä¸€ä»‹ç»ã€‚</p>\n<p>é€šè¿‡æŸ¥æ‰¾æ–¹æ³•åœ¨åŸå‹é“¾æ‰¾åˆ°äº†this.localStorageSupportedçš„å®šä¹‰ï¼ˆä¹Ÿå°±æ˜¯ä¸Šæ–‡çš„supportedï¼‰ï¼Œç”¨é€”æ˜¯ä¸ºäº†æµ‹è¯•æµè§ˆå™¨æ˜¯å¦æ”¯æŒwindow.localStorageã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">LocalStorageManager</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span> <span class=\"token function-variable function\">localStorageSupported</span><span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> testKey <span class=\"token operator\">=</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> storage <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>localStorage<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      storage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>testKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      storage<span class=\"token punctuation\">.</span><span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span>testKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä½¿ç”¨try..catchè¯­å¥æµ‹è¯•storage.setItemå’Œstorage.removeItemï¼Œæ¥ç¡®ä¿æµè§ˆå™¨æ”¯æŒwindow.localStorageï¼Œæ‰§è¡ŒæˆåŠŸè¿”å›trueï¼Œå¦åˆ™æ‰§è¡Œcatché‡Œé¢çš„è¯­å¥è¿”å›falseã€‚</p>\n<p>fakeStorageå°±æ˜¯ä½œè€…è‡ªå·±å†™çš„ä¸€ä¸ªlocalStorageçš„æ›¿ä»£æ–¹æ³•ï¼Œä¹Ÿå®šä¹‰äº†setItemæ–¹æ³•ï¼ŒgetItemæ–¹æ³•å’ŒremoveItemæ–¹æ³•ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">window<span class=\"token punctuation\">.</span>fakeStorage <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    _data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">setItem</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_data<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">getItem</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_data<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_data<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">removeItem</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">delete</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_data<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">clear</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>æœ€åä½¿ç”¨äº† JSON.parse()å’ŒJSON.stringify()ã€‚</p>\n<p>JSON.parse() æ–¹æ³•å°†JSON å­—ç¬¦ä¸²è§£ææˆä¸º JavaScript ä¸­å¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p>\n<p>JSON.stringify() æ–¹æ³•å°†ä»»æ„JavaScript å¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">LocalStorageManager</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getGameState</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> stateJSON <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gameStateKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> stateJSON <span class=\"token operator\">?</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>stateJSON<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token class-name\">LocalStorageManager</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setGameState</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">gameState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gameStateKey<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>gameState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>é˜…è¯»å®Œlocal<em>storage</em>manager.jsï¼Œäº†è§£å…¶ä¸ä»…ä¿å­˜äº†åˆ†æ•°ï¼Œè¿˜ä¿å­˜äº†æ¸¸æˆçŠ¶æ€ã€‚ç”±æ­¤local<em>storage</em>manager.jsä¼šè¢«ç»å¸¸è°ƒç”¨ï¼Œç½—åˆ—ä¸€ä¸‹è°ƒç”¨æƒ…å†µï¼š</p>\n<p>game_manager.jsä¸­è°ƒç”¨è¿‡</p>\n<ul>\n<li>LocalStorageManager.getBestScore</li>\n<li>LocalStorageManager.setBestScore</li>\n<li>LocalStorageManager.setGameState</li>\n<li>LocalStorageManager.clearGameState</li>\n<li>LocalStorageManager.setBestScore</li>\n</ul>\n<p>grid.jsè°ƒç”¨</p>\n<ul>\n<li>LocalStorageManager.setBestScore</li>\n</ul>","frontmatter":{"title":"2048æºä»£ç è§£è¯»ï¼ˆ3ï¼‰","date":"August 18, 2015"},"fields":{"slug":"/2015-08-18-2048-local-storage-manager/"}}},"pageContext":{"slug":"/2015-08-18-2048-local-storage-manager/","previous":{"fields":{"slug":"/2015-08-14-2048-input-mannager/"},"frontmatter":{"title":"2048æºä»£ç è§£è¯»ï¼ˆ2ï¼‰","tags":["æºç é˜…è¯»"]}},"next":{"fields":{"slug":"/2015-08-19-read-source-code-of-2048-4/"},"frontmatter":{"title":"2048æºä»£ç è§£è¯»ï¼ˆ4ï¼‰","tags":["æºç é˜…è¯»"]}}}}}