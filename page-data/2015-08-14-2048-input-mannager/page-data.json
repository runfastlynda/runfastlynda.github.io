{"componentChunkName":"component---src-templates-blog-post-js","path":"/2015-08-14-2048-input-mannager/","result":{"data":{"site":{"siteMetadata":{"title":"runfastlyndağŸ‘€"}},"markdownRemark":{"id":"3f847563-f108-53c6-915f-3b044b62a124","excerpt":"ä¸Šæ–‡ä»‹ç»äº†2048æºç çš„å®è§‚æƒ…å†µï¼Œä¸‹é¢æ‰“ç®—ä»”ç»†çš„çœ‹çœ‹æºä»£ç ï¼Œæˆ‘è‡ªå·±å¾ˆæ„Ÿå…´è¶£äºé”®ç›˜æ§åˆ¶è¿™ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å†³å®šå…ˆé˜…è¯»input_mannager.jsè¿™ä¸€éƒ¨åˆ†ã€‚ ä»”ç»†æŸ¥çœ‹äº†input_mannager.jsçš„æºä»£ç å‘ç°å¥½å¤šçš„prototypeã€‚é‚£å…ˆæ¥çœ‹çœ‹prototypeæ˜¯ä»€ä¹ˆï¼Ÿ javascriptä¸­çš„prototypeâ€¦","html":"<p>ä¸Šæ–‡ä»‹ç»äº†2048æºç çš„å®è§‚æƒ…å†µï¼Œä¸‹é¢æ‰“ç®—ä»”ç»†çš„çœ‹çœ‹æºä»£ç ï¼Œæˆ‘è‡ªå·±å¾ˆæ„Ÿå…´è¶£äºé”®ç›˜æ§åˆ¶è¿™ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å†³å®šå…ˆé˜…è¯»input_mannager.jsè¿™ä¸€éƒ¨åˆ†ã€‚</p>\n<p>ä»”ç»†æŸ¥çœ‹äº†input_mannager.jsçš„æºä»£ç å‘ç°å¥½å¤šçš„prototypeã€‚é‚£å…ˆæ¥çœ‹çœ‹prototypeæ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<h3>javascriptä¸­çš„prototype</h3>\n<p>åœ¨JavaScriptè¯­è¨€ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„åŸå‹å¯¹è±¡ï¼Œè¢«ç§°ä¸ºprototypeå¯¹è±¡ã€‚å®šä¹‰åœ¨åŸå‹å¯¹è±¡ä¸Šçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œéƒ½èƒ½è¢«æ´¾ç”Ÿå¯¹è±¡ç»§æ‰¿ã€‚</p>\n<p>é‚£ä¹ˆè¿™é‡Œå¦‚æœä¿®æ”¹äº†prototypeå¯¹è±¡ï¼Œå˜åŠ¨å°±ç«‹åˆ»ä¼šä½“ç°åœ¨å®ä¾‹å¯¹è±¡ä¸­ã€‚</p>\n<h3>call()</h3>\n<p>JavaScriptä¸­thisçš„åŠ¨æ€åˆ‡æ¢ï¼Œä¸ºå…¶åˆ›é€ äº†å·¨å¤§çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿä½¿å¾—ç¼–ç¨‹å˜çš„å›°éš¾å’Œæ¨¡ç³Šã€‚input_mannager.jsè¿™é‡Œè¿ç”¨äº†call()çš„æ–¹æ³•æ¥å›ºå®šthisçš„ç¡®åˆ‡æŒ‡å‘ï¼Œç¡®å®šæ‰§è¡Œçš„ä½œç”¨åŸŸã€‚</p>\n<p>å‡½æ•°çš„callæ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šè¯¥å‡½æ•°å†…éƒ¨thisçš„æŒ‡å‘ï¼Œç„¶ååœ¨æ‰€æŒ‡å®šçš„ä½œç”¨åŸŸä¸­ï¼Œè°ƒç”¨è¯¥å‡½æ•°ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\t<span class=\"token function\">func</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>thisValue<span class=\"token punctuation\">,</span> arg1<span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">,</span> â€¦<span class=\"token punctuation\">)</span></code></pre></div>\n<p> arg1, arg2æ˜¯å¯ä»¥ä¼ å…¥çš„å‚æ•°ã€‚</p>\n<h3>input_mannager.js</h3>\n<p>KeyboardInputManagerå‡½æ•°æœ‰å¦‚ä¸‹ç»“æ„ï¼š</p>\n<p><img src=\"http://7xjufd.dl1.z0.glb.clouddn.com/blog2.1.png\" alt=\"æ€ç»´å¯¼å›¾\"></p>\n<p>æ‰“å¼€åæˆ‘ä»¬çœ‹åˆ°äº†ä¸‹é¢çš„ä»£ç </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>msPointerEnabled<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">//è¿™é‡Œè€ƒè™‘çš„æ˜¯æµè§ˆå™¨å…¼å®¹æ€§çš„é—®é¢˜</span>\n<span class=\"token comment\">//ifé‡Œçš„åˆ¤æ–­è¯­å¥æ˜¯åˆ¤æ–­ç”¨æˆ·è®¾å¤‡æ˜¯ä¸æ˜¯Internet Explorer 10 æ”¯ä¸æ”¯æŒmsPointerç›¸å…³äº‹ä»¶</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchstart    <span class=\"token operator\">=</span> <span class=\"token string\">\"MSPointerDown\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchmove     <span class=\"token operator\">=</span> <span class=\"token string\">\"MSPointerMove\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchend      <span class=\"token operator\">=</span> <span class=\"token string\">\"MSPointerUp\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchstart    <span class=\"token operator\">=</span> <span class=\"token string\">\"touchstart\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchmove     <span class=\"token operator\">=</span> <span class=\"token string\">\"touchmove\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchend      <span class=\"token operator\">=</span> <span class=\"token string\">\"touchend\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¿™æ˜¯ä¸ºäº†ç»Ÿä¸€ä¸åŒçš„æµè§ˆå™¨ä¸­å¯¹è§¦æ‘¸äº‹ä»¶çš„å¤„ç†ï¼Œè¿ç”¨çš„ifåˆ¤æ–­è¯­å¥ç»Ÿä¸€å‘½åï¼Œä¸ºåé¢çš„ç¼–ç¨‹åšå‡†å¤‡ã€‚</p>\n<p>æ¥ç€ä¸‹ä¸€è¡Œæœ‰è¿™æ ·çš„ä»£ç </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>thisæŒ‡ä»£KeyboardInputManagerè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä»KeyboardInputManagerçš„åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†å¯¹listençš„å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯KeyboardInputManager.prototype.listenï¼Œé‚£ä¹ˆæŸ¥çœ‹è¿™ä¸ªå¯¹è±¡ã€‚</p>\n<p>é¦–å…ˆæ˜¯å¯¹é”®ç›˜çš„æ§åˆ¶</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// å¯¹å…¨å±€è¿›è¡Œäº‹ä»¶ç›‘å¬ï¼ŒæŠŠæ¡é”®ç›˜æ–¹å‘é”®çš„æ§åˆ¶</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keydown\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> modifiers <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>altKey <span class=\"token operator\">||</span> event<span class=\"token punctuation\">.</span>ctrlKey <span class=\"token operator\">||</span> event<span class=\"token punctuation\">.</span>metaKey <span class=\"token operator\">||</span>event<span class=\"token punctuation\">.</span>shiftKey<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//ä½¿ç”¨é€»è¾‘æˆ–|| æŠŠaltï¼Œctrlï¼Œmetaï¼Œshiftå››ä¸ªé”®æŒ‰ä¸‹çš„äº‹ä»¶èµ‹ç»™äº†modifiers;</span>\n\n<span class=\"token keyword\">var</span> mapped    <span class=\"token operator\">=</span> map<span class=\"token punctuation\">[</span>event<span class=\"token punctuation\">.</span>which<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//åˆ¤æ–­æŒ‰é”®æ˜¯å¦æ ‡å‡†ï¼Œæ‰§è¡Œç§»åŠ¨çš„å‡½æ•°</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>modifiers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mapped <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tevent<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tself<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"move\"</span><span class=\"token punctuation\">,</span> mapped<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// æ·»åŠ Rå¿«æ·é”®çš„è¡Œä¸º</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>modifiers <span class=\"token operator\">&amp;&amp;</span> event<span class=\"token punctuation\">.</span>which <span class=\"token operator\">===</span> <span class=\"token number\">82</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tself<span class=\"token punctuation\">.</span><span class=\"token function\">restart</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æœ‰è¶£çš„æ˜¯è¿™é‡Œä¸ä»…ç»™å…‰æ ‡ç§»åŠ¨æ˜ å°„äº†ä¸Šä¸‹å·¦å³çš„ç§»åŠ¨äº‹ä»¶ï¼Œè¿˜å¯¹å¸¸ç”¨çš„æ¸¸æˆæŒ‰é”®<code class=\"language-text\">W</code> <code class=\"language-text\">A</code> <code class=\"language-text\">S</code> <code class=\"language-text\">D</code>,è¿˜æœ‰Vimä¸­çš„<code class=\"language-text\">H</code> <code class=\"language-text\">J</code> <code class=\"language-text\">K</code> <code class=\"language-text\">L</code>æ˜ å°„äº†ä¸Šä¸‹å·¦å³çš„ç§»åŠ¨äº‹ä»¶ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> map <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token number\">38</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Up</span>\n\t<span class=\"token number\">39</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Right</span>\n\t<span class=\"token number\">40</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Down</span>\n\t<span class=\"token number\">37</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Left</span>\n\t<span class=\"token number\">75</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Vim up</span>\n\t<span class=\"token number\">76</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Vim right</span>\n\t<span class=\"token number\">74</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Vim down</span>\n\t<span class=\"token number\">72</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Vim left</span>\n\t<span class=\"token number\">87</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// W</span>\n\t<span class=\"token number\">68</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// D</span>\n\t<span class=\"token number\">83</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// S</span>\n\t<span class=\"token number\">65</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>  <span class=\"token comment\">// A</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ç„¶åæ˜¯ç§»åŠ¨ç«¯æ»‘åŠ¨æ§åˆ¶</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> touchStartClientX<span class=\"token punctuation\">,</span> touchStartClientY<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> gameContainer <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"game-container\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//å®šä¹‰äº†é¡µé¢ä¸­game-containerè¿™ä¸€éƒ¨åˆ†</span>\n\n<span class=\"token comment\">//æ·»åŠ å¯¹gameContainerçš„ç›‘å¬äº‹ä»¶</span>\ngameContainer<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventTouchstart<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>msPointerEnabled <span class=\"token operator\">&amp;&amp;</span> event<span class=\"token punctuation\">.</span>touches<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>event<span class=\"token punctuation\">.</span>targetTouches <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//å°†å¤šä½™ä¸€ä¸ªæŒ‡å¤´çš„æ»‘åŠ¨äº‹ä»¶å¿½ç•¥</span></code></pre></div>\n<p>å¯¹game-containerè¿›è¡Œäº‹ä»¶ç›‘å¬ï¼Œæ„å‘³ç€åªæœ‰åœ¨game-containeré‡Œçš„æ»‘åŠ¨æ‰æœ‰æ•ˆçš„ï¼Œæ¥ç€è·å–æ»‘åŠ¨çš„èµ·å§‹åæ ‡ï¼Œè·å–æ»‘åŠ¨é•¿åº¦ç­‰ç­‰ã€‚</p>\n<p>æˆ‘ä»¬æ¥çœ‹é‡ç‚¹çš„åˆ¤æ–­æ»‘åŠ¨æ–¹å‘</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>absDx<span class=\"token punctuation\">,</span> absDy<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tself<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"move\"</span><span class=\"token punctuation\">,</span> absDx <span class=\"token operator\">></span> absDy <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>dx <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>dy <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token number\">2</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// (right : left) : (down : up)</span></code></pre></div>\n<p>ä½¿ç”¨äº†ä¸¤æ¬¡ä¸‰ç›®è¿ç®—çš„æ–¹æ³•ï¼Œæ¯”è¾ƒabsDxå’ŒabsDyçš„å¤§å°ï¼Œè°å¤§ä»£è¡¨åœ¨è°çš„åæ ‡æ»‘åŠ¨ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯ä¸Šä¸‹è¿˜æ˜¯å·¦å³ï¼Œå¦‚æœabsDxå¤§ï¼Œåˆ¤æ–­dxçš„æ­£è´Ÿï¼Œæ­£æ˜¯å‘å³ç§»åŠ¨ï¼Œè´Ÿæ˜¯å‘å·¦ç§»åŠ¨ï¼Œ\nå¦‚æœæ˜¯absDyå¤§ï¼Œåˆ¤æ–­dyçš„æ­£è´Ÿï¼Œæ­£æ˜¯å‘ä¸‹ç§»åŠ¨ï¼Œè´Ÿæ˜¯å‘ä¸Šç§»åŠ¨ã€‚</p>\n<p>ä¸¾ä¸ªæ —å­ï¼š</p>\n<p><img src=\"http://7xjufd.dl1.z0.glb.clouddn.com/blog2.2.png\" alt=\"ä¾‹å­\"></p>\n<p>å›¾ä¸­absDxå’ŒabsDyæ˜¯dxå’Œdyçš„ç»å¯¹å€¼,é¦–å…ˆå¯ä»¥åˆ¤æ–­ absDx &#x3C; absDy,é‚£ä¹ˆå°±åœ¨ä¸Šä¸‹ä¸¤ä¸ªæ–¹å‘åšåˆ¤æ–­ï¼Œåˆå› ä¸ºdyæ˜¯å°äº0çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ»‘åŠ¨äº‹ä»¶å°±ä»£è¡¨ç€å‘ä¸Šæ»‘åŠ¨ã€‚</p>","frontmatter":{"title":"2048æºä»£ç è§£è¯»ï¼ˆ2ï¼‰","date":"August 14, 2015"},"fields":{"slug":"/2015-08-14-2048-input-mannager/"}}},"pageContext":{"slug":"/2015-08-14-2048-input-mannager/","previous":{"fields":{"slug":"/2015-08-13-read-2048-source-code/"},"frontmatter":{"title":"2048æºä»£ç è§£è¯»ï¼ˆ1ï¼‰","tags":["æºç é˜…è¯»"]}},"next":{"fields":{"slug":"/2015-08-18-2048-local-storage-manager/"},"frontmatter":{"title":"2048æºä»£ç è§£è¯»ï¼ˆ3ï¼‰","tags":["æºç é˜…è¯»"]}}}}}