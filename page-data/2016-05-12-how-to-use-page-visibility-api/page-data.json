{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016-05-12-how-to-use-page-visibility-api/","result":{"data":{"site":{"siteMetadata":{"title":"runfastlyndağŸ‘€"}},"markdownRemark":{"id":"d2768ee3-ca74-5f15-b228-50358381b63a","excerpt":"Page Visibility APIæ˜¯HTML5ä¸­ç®€å•åˆå®ç”¨çš„APIä¹‹ä¸€ã€‚ ä¸çŸ¥é“ç”¨æˆ·æ˜¯ä¸æ˜¯åœ¨ä¸é¡µé¢äº¤äº’ï¼Œè¿™æ˜¯å›°æ‰°å¹¿å¤§Webå¼€å‘äººå‘˜çš„ä¸€ä¸ªä¸»è¦é—®é¢˜ã€‚å¦‚æœé¡µé¢æœ€å°åŒ–äº†æˆ–è€…éšè—åœ¨äº†å…¶ä»–æ ‡ç­¾é¡µåé¢ï¼Œé‚£ä¹ˆæœ‰äº›åŠŸèƒ½æ˜¯å¯ä»¥åœä¸‹æ¥çš„ï¼Œæ¯”å¦‚è½®è¯¢æœåŠ¡å™¨æˆ–è€…æŸäº›åŠ¨ç”»æ•ˆæœã€‚é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿ H5ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬onfocusâ€¦","html":"<p>Page Visibility APIæ˜¯HTML5ä¸­ç®€å•åˆå®ç”¨çš„APIä¹‹ä¸€ã€‚</p>\n<p>ä¸çŸ¥é“ç”¨æˆ·æ˜¯ä¸æ˜¯åœ¨ä¸é¡µé¢äº¤äº’ï¼Œè¿™æ˜¯å›°æ‰°å¹¿å¤§Webå¼€å‘äººå‘˜çš„ä¸€ä¸ªä¸»è¦é—®é¢˜ã€‚å¦‚æœé¡µé¢æœ€å°åŒ–äº†æˆ–è€…éšè—åœ¨äº†å…¶ä»–æ ‡ç­¾é¡µåé¢ï¼Œé‚£ä¹ˆæœ‰äº›åŠŸèƒ½æ˜¯å¯ä»¥åœä¸‹æ¥çš„ï¼Œæ¯”å¦‚è½®è¯¢æœåŠ¡å™¨æˆ–è€…æŸäº›åŠ¨ç”»æ•ˆæœã€‚é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿ</p>\n<p>H5ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬onfocus()äº‹ä»¶ã€‚å¦‚æœå½“å‰çª—å£å¾—åˆ°ç„¦ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç®€å•è®¤ä¸ºç”¨æˆ·åœ¨ä¸è¯¥é¡µé¢äº¤äº’ï¼Œå¦‚æœå¤±å»ç„¦ç‚¹ï¼ˆonblur()ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºç”¨æˆ·åœæ­¢ä¸è¯¥é¡µé¢äº¤äº’ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// å½“å‰çª—å£å¾—åˆ°ç„¦ç‚¹</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onfocus</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// åŠ¨ç”»å¼€å§‹</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// å½“å‰çª—å£å¤±å»ç„¦ç‚¹</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onblur</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// åœæ­¢åŠ¨ç”»</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ä½†æ˜¯è¿™æ ·çš„æ–¹æ³•æ˜¾ç„¶æ˜¯å¾ˆ â€œç²—ç³™â€ çš„ã€‚æµè§ˆå™¨å¤±å»ç„¦ç‚¹ï¼Œä¸æ„å‘³ç€ç”¨æˆ·æ²¡åœ¨ä¸é¡µé¢äº¤äº’ï¼ŒH5å¼•å…¥çš„Page Visibility APIï¼Œèƒ½å¾ˆæœ‰æ•ˆåœ°å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™æ ·çš„åˆ¤æ–­ã€‚</p>\n<p>è¿™ä¸ªAPIæœ¬èº«éå¸¸ç®€å•ï¼Œç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆã€‚</p>\n<p>document.hiddenï¼šè¡¨ç¤ºé¡µé¢æ˜¯å¦éšè—çš„å¸ƒå°”å€¼ã€‚é¡µé¢éšè—åŒ…æ‹¬ é¡µé¢åœ¨åå°æ ‡ç­¾é¡µä¸­ æˆ–è€… æµè§ˆå™¨æœ€å°åŒ–ï¼ˆæ³¨æ„ï¼Œé¡µé¢è¢«å…¶ä»–è½¯ä»¶é®ç›–å¹¶ä¸ç®—éšè—ï¼Œæ¯”å¦‚æ‰“å¼€çš„ sublime é®ä½äº†æµè§ˆå™¨ï¼‰</p>\n<p>document.visibilityStateï¼šè¡¨ç¤ºä¸‹é¢ 4 ä¸ªå¯èƒ½çŠ¶æ€çš„å€¼</p>\n<ul>\n<li>hiddenï¼šé¡µé¢åœ¨åå°æ ‡ç­¾é¡µä¸­æˆ–è€…æµè§ˆå™¨æœ€å°åŒ–</li>\n<li>visibleï¼šé¡µé¢åœ¨å‰å°æ ‡ç­¾é¡µä¸­</li>\n<li>prerenderï¼šé¡µé¢åœ¨å±å¹•å¤–æ‰§è¡Œé¢„æ¸²æŸ“å¤„ç† document.hidden çš„å€¼ä¸º true</li>\n<li>unloadedï¼šé¡µé¢æ­£åœ¨ä»å†…å­˜ä¸­å¸è½½</li>\n</ul>\n<p>Visibilitychangeäº‹ä»¶ï¼šå½“æ–‡æ¡£ä»å¯è§å˜ä¸ºä¸å¯è§æˆ–è€…ä»ä¸å¯è§å˜ä¸ºå¯è§æ—¶ï¼Œä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚</p>\n<p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬Visibilitychangeäº‹ä»¶ï¼Œå½“è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œè·å–document.hiddençš„å€¼ï¼Œæ ¹æ®è¯¥å€¼è¿›è¡Œé¡µé¢ä¸€äº›äº‹ä»¶çš„å¤„ç†ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'visibilitychange'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> isHidden <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>hidden<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isHidden<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// åŠ¨ç”»åœæ­¢</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// åŠ¨ç”»å¼€å§‹</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>å®é™…è¿ç”¨ï¼š</h3>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ®é¡µé¢å¯è§æ€§æ›´æ”¹titleçš„ä¾‹å­ï¼Œç‰¹åˆ«æœ‰è¶£ï¼Œå®ç°æ•ˆæœå¦‚ä¸‹ï¼š</p>\n<p>å½“æˆ‘é€‰æ‹©å…¶ä»–tagæ—¶ï¼Œå®ƒçš„titleæ˜¾ç¤ºä¸ºå¦‚ä¸‹ï¼š</p>\n<p><img src=\"../../../../img/page2.png\"></p>\n<p>å½“æˆ‘é€‰æ‹©å½“å‰é¡µé¢ï¼Œå®ƒçš„titleæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>\n<p><img src=\"../../../../img/page1.png\"></p>\n<p>åºŸè¯ä¸è¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//è€ƒè™‘äº†å…¼å®¹æ€§</span>\n<span class=\"token keyword\">var</span> glb <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  d<span class=\"token operator\">:</span> document<span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">addEvent</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>addEventListener<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      a<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>attachEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      a<span class=\"token punctuation\">.</span><span class=\"token function\">attachEvent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'on'</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">delEvent</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>removeEventListener<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      a<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>detachEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      a<span class=\"token punctuation\">.</span><span class=\"token function\">detachEvent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'on'</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nglb<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">stateEvent</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>visibilityState <span class=\"token operator\">==</span> <span class=\"token string\">'prerender'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'é¢„æ¸²æŸ“ä¸­....'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>visibilityState <span class=\"token operator\">==</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'ä½ å¯ä»¥çœ‹åˆ°æˆ‘å“¦~'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>visibilityState <span class=\"token operator\">==</span> <span class=\"token string\">'hidden'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'ä½ çœ‹ä¸åˆ°æˆ‘äº†!'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nglb<span class=\"token punctuation\">.</span><span class=\"token function\">stateEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nglb<span class=\"token punctuation\">.</span><span class=\"token function\">addEvent</span><span class=\"token punctuation\">(</span>glb<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">,</span> <span class=\"token string\">'visibilitychange'</span><span class=\"token punctuation\">,</span> glb<span class=\"token punctuation\">.</span>stateEvent<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"æ´»å­¦æ´»ç”¨é¡µé¢å¯è§æ€§","date":"May 12, 2016"},"fields":{"slug":"/2016-05-12-how-to-use-page-visibility-api/"}}},"pageContext":{"slug":"/2016-05-12-how-to-use-page-visibility-api/","previous":{"fields":{"slug":"/2016-03-12-use-border-make-triangle/"},"frontmatter":{"title":"å·§ç”¨borderå®ç°æ¢¯å½¢å’Œä¸‰è§’å½¢","tags":null}},"next":{"fields":{"slug":"/2016-07-04-read-html5-boilerplate/"},"frontmatter":{"title":"è¯»æºç ï¼šHTML5 Boilerplate","tags":null}}}}}